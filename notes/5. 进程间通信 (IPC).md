# 进程间通信 (IPC) in Electron

在 Electron 中，应用程序由一个**主进程 (Main Process)** 和一个或多个**渲染器进程 (Renderer Process)** 组成。主进程负责管理应用的生命周期、原生 GUI 元素（如窗口、菜单）等，而每个渲染器进程负责一个网页（通常是一个 `BrowserWindow` 实例）。

由于 [[4. 主进程与渲染器进程]] 运行在不同的操作系统进程中，它们拥有独立的内存空间，不能直接共享数据或调用对方的函数。**进程间通信 (IPC)** 就是为了解决这个问题，提供了一种在这些不同进程之间安全地传递消息的机制。

## 核心概念

Electron 的 IPC 主要基于事件驱动模型，使用 `ipcMain` (在主进程中) 和 `ipcRenderer` (在渲染器进程中) 模块。

-   **通道 (Channel):** 消息通过指定的字符串“通道”发送和接收。发送方和接收方必须监听同一个通道才能通信。
-   **消息 (Message):** 可以是任何可序列化的数据（字符串、数字、数组、简单对象等）。

## 主要通信方式

根据你的学习大纲，主要有以下几种通信模式：

-   [[渲染器到主进程 (单向)]]: 渲染器向主进程发送消息，不期望回复。
-   [[渲染器到主进程 (双向)]]: 渲染器向主进程发送消息，并等待主进程的回复。
-   [[主进程到渲染器]]: 主进程向特定的渲染器进程发送消息。
-   [[渲染器到渲染器]]: 一个渲染器进程通过主进程中转，向另一个渲染器进程发送消息。

## 安全风险与注意事项

由于渲染器进程可能加载不受信任的远程内容，IPC 通信是 Electron 安全模型中的一个关键环节。不当的 IPC 实现可能带来安全风险：

1.  **通道滥用:** 如果主进程暴露了过于强大的 IPC 接口（例如，允许渲染器直接执行任意 Node.js 代码或访问文件系统），恶意网页可能会利用这些接口进行攻击。
2.  **数据未校验:** 主进程应该始终校验来自渲染器进程的数据。不要信任渲染器发送的任何数据，因为它可能被篡改。
3.  **敏感信息泄露:** 避免通过 IPC 发送敏感信息（如密钥、密码），除非绝对必要且采取了加密措施。
4.  **资源耗尽:** 恶意的渲染器进程可能通过频繁发送大量 IPC 消息来耗尽主进程的资源。

**最佳实践:**

-   使用 [[上下文隔离]] 和 [[3. 预加载脚本]]。
-   通过 `contextBridge` 暴露有限且经过验证的 IPC 接口给渲染器，而不是直接暴露 `ipcRenderer`。
-   在 `ipcMain` 的监听器中，严格校验所有传入的数据和参数。
-   为不同的功能使用不同的 IPC 通道，避免使用过于通用的通道。

#electron #ipc #security